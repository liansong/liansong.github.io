<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body { margin: 0; overflow: hidden; }
			canvas { width: 100%; height: 100%}
		</style>
	</head>
	<body>
		<script src="assets/js/three/three.js"></script>
		<script src="assets/js/three/TrackballControls.js"></script>
		<script src="assets/js/three/DragControls.js"></script>
		<script src="assets/js/three/OBJLoader.js"></script>

		<script>

		var scene, camera, renderer, group;
		var controls, dragControls;
		var objects = [];
		var loader = new THREE.OBJLoader();

		init();
		animate();

		function init() {

			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

			scene.add(new THREE.AmbientLight( 0x404040 ));
			
			controls = new THREE.TrackballControls(camera);
			controls.rotateSpeed = 1.0;
			controls.zoomSpeed = 1.2;
			controls.panSpeed = 0.8;
			controls.staticMoving = true;
			controls.dynamicDampingFactor = 0.3;
			controls.maxDistance = 8;

			// control.addEventListener( 'change', render );

			var light = new THREE.SpotLight( 0xffffff, 1.5 );
			light.position.set( 0, 500, 500 );
			light.castShadow = true;
			light.shadow = new THREE.LightShadow( new THREE.PerspectiveCamera( 50, 1, 200, 10000 ) );
			light.shadow.bias = - 0.00022;
			light.shadow.mapSize.width = 2048;
			light.shadow.mapSize.height = 2048;
			scene.add( light );

			var particleMaterial = new THREE.MeshBasicMaterial();
			particleMaterial.side = THREE.DoubleSide;

			loader.load("obj/mush.obj", function (geometry) {
				var mush = new THREE.Mesh(geometry, particleMaterial);
				scene.add(mush);
			});

			var geometry = new THREE.BoxGeometry( 1, 1, 1 );
			var circleGeo = new THREE.SphereGeometry(.6, 16);
			// var material = new THREE.MeshLambertMaterial( { color: 0x00ff00 } );
			
			group = new THREE.Group();

			for (var i = 0; i < 320; i++) {
				
				var object = new THREE.Mesh(circleGeo, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ));
				if (i % 2 == 1) {
					console.log(objects[i-1].position.x)
					object.position.x = objects[i-1].position.x
					object.position.y = objects[i-1].position.y
					object.position.z = objects[i-1].position.z
				} else {
					object.position.x = Math.floor(Math.random() * 20) - 10;
					object.position.y = Math.floor(Math.random() * 20) - 10;
					object.position.z = Math.floor(Math.random() * 20) - 10;
				}

				object.scale.x = object.scale.y = object.scale.z = 2

				object.rotation.x = Math.random() 
				object.rotation.y = Math.random()

				object.castShadow = true;
				object.receiveShadow = true;

				group.add(object);
				objects.push(object);
			}

			scene.add(group);

			camera.position.z = 10;

			renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			dragControls = new THREE.DragControls( objects, camera, renderer.domElement );
			dragControls.addEventListener( 'dragstart', function ( event ) { controls.enabled = false; } );
			dragControls.addEventListener( 'dragend', function ( event ) { controls.enabled = true; } );
		}

		var counter;
		function animate() {

			requestAnimationFrame(animate);
			if (counter <= 100) {
				group.position.x += 0.04;
				group.position.z -= 0.02;
				group.position.y -= 0.03;
				counter++;
			}

			if (counter > 100) {
				group.position.x -= 0.04;
				group.position.z += 0.02;
				group.position.y += 0.03;
				counter++;
			}

			if (counter > 200) {
				counter = 0;
			}

			group.rotation.x += 0.01;

			for (i=0; i < 320; i++) {
				objects[i].rotation.x += Math.random() / 10;
				objects[i].rotation.y += Math.random() / 10;
			}

			// 	if (counter % 2 == 0) {
			// 		objects[i].position.x += 0.2;
			// 	} else {
			// 		objects[i].position.x -= 0.2;
			// 	}

			// 	counter += 1;
			// }

			controls.update();
			renderer.render( scene, camera );
		}

		// var animate = function () {
		// 	requestAnimationFrame( animate );

		// 	cube.rotation.x += 0.3;
		// 	cube.rotation.y += 0.1;

		// 	renderer.render(scene, camera);
		// };

		// animate();

		</script>
	</body>
</html>